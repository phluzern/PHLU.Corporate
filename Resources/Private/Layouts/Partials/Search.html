{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace ts=TYPO3\TypoScript\ViewHelpers}
<div class="row" data-ng-controller="SearchCtrl" id="search">
    <div data-ng-class="{hasSearchResults: siteSearch != ''}" style="display:none">
        <div class="row phlu-searchresults">

            <div class="close" data-ng-click="stopSearch();"></div>
            <div class="searchresults-count">Suchergebnisse {{siteSearch}} ({{result.count()}})</div>


            <div class="turbo-link-result" data-ng-if="result.countTurboNodes()">
                <div class="result turbonode" ng-repeat="(index,node) in result.getTurboNodes() | orderBy:'-score'"
                     ng-if="index === 0">
                    <search data="node"></search>
                </div>
            </div>


            <div class="phlu-corporate-tags-menu" data-ng-if="result.getGrouped().count() > 1">
                <div class="row subjectsfilternav ">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-12">
                                <ul class="nav nav-pills nav-justified" role="tablist">
                                    <li class="nav-item clickable ">
                                        <a class="nav-link all" data-ng-class="{active: lastActiveTabName == 'alle'}"
                                           data-toggle="tab" href="#alle" role="tab">Alle</a>
                                    </li>
                                    <li class="nav-item clickable" ng-repeat="group in result.getGrouped().getItems()">

                                        <a class="nav-link"
                                           data-ng-class="{active: lastActiveTabName == group.getLabel()}"
                                           data-toggle="tab" href="#{{group.getLabel()}}"
                                           role="tab"><span node-type name="{{group.getLabel()}}"></span>
                                            <span>({{group.count()}})</span></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row results-table" data-ng-if="result.getGrouped().count() > 1">
                <div class="col-xs-12 tab-content">


                    <div class="result-panel tab-pane nofilter fade"
                         data-ng-class="{active: lastActiveTabName == 'alle', in: lastActiveTabName == 'alle'}"
                         id="alle" role="tabpanel">
                        <div class="table-responsive">
                            <table class="table">
                                <tbody>
                                <tr ng-repeat="node in result.getNodes() | orderBy:'-score'"
                                    data-ng-if="!node.isTurboNode()">
                                    <td class="clickable">
                                        <search data="node" view="all"></search>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="result-panel tab-pane nofilter fade "
                         data-ng-class="{active: lastActiveTabName == group.getLabel(), in: lastActiveTabName == group.getLabel()}"
                         id="{{group.getLabel()}}" role="tabpanel" ng-repeat="group in result.getGrouped().getItems()">


                        <div data-ng-switch="group.getLabel()">


                            <div class="ppdb-list" data-ng-switch-when="Projekte">


                                <div class=" results-table">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th class="clickable">
                                                    <a href="#">Projektname</a>
                                                </th>
                                                <th class="clickable">
                                                    <a href="#">Schwerpunkte</a>
                                                </th>
                                            </tr>
                                            </thead>

                                            <tbody ng-repeat="node in group.getNodes() | orderBy:'-score'" data-ng-click="node.isopen = node.isopen ? false : true">
                                            <tr data-ng-class="{open: node.isopen,noborder: $index > 0}" class="clickable">
                                                <td>
                                                    <span class="oi" data-ng-class="{'oi-caret-right': !node.isopen, 'oi-caret-bottom': node.isopen}"></span>
                                                    <span>{{node.getProperty('title')}}</span>
                                                    <div class="mobile-view-columns">
                                                        <span class="header">
                                                            Schwerpunkte
                                                        </span>
                                                        <span data-ng-repeat="focus in node.getProperty('researchmainfocus') track by $index">- {{focus}}<br></span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span data-ng-repeat="focus in node.getProperty('researchmainfocus') track by $index">- {{focus}}<br></span>
                                                </td>
                                            </tr>
                                            <tr class="result-preview" data-ng-show="node.isopen">
                                                <td colspan="2">
                                                    <div>
                                                        <div ng-bind-html="node.getProperty('abstracttextgerman').substr(0,255) + '...'"></div>
                                                        <a class="btn btn-primary" href="{{node.getUrl()}}">
                                                            Details
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            </tbody>

                                        </table>
                                    </div>

                                </div>


                            </div>


                            <div class="table-responsive" data-ng-switch-default>
                                <table class="table">
                                    <tbody>
                                    <tr ng-repeat="node in group.getNodes() | orderBy:'-score'"
                                        data-ng-if="!node.isTurboNode()">
                                        <td class="clickable">
                                            <search data="node" view="group"></search>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>


                        </div>

                    </div>


                </div>
            </div>


            <div class="row results-table" data-ng-if="result.getGrouped().count() == 1">
                <div class="col-xs-12 tab-content">

                    <div class="result-panel tab-pane nofilter fade active in" id="{{group.getLabel()}}" role="tabpanel"
                         ng-repeat="group in result.getGrouped().getItems()">
                        <div class="table-responsive">
                            <table class="table">
                                <tbody>
                                <tr ng-repeat="node in group.getNodes() | orderBy:'-score'"
                                    data-ng-if="!node.isTurboNode()">
                                    <td class="clickable">
                                        <search data="node" view="group"></search>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>


                </div>
            </div>


        </div>

    </div>
</div>